
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.11">
    
    
      
        <title>**Fine-grained Authorization with LakeFormation Integration** - Amazon EMR Train-The-Trainer Workshop</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50e68009.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#fine-grained-authorization-with-lakeformation-integration" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Amazon EMR Train-The-Trainer Workshop" class="md-header__button md-logo" aria-label="Amazon EMR Train-The-Trainer Workshop" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Amazon EMR Train-The-Trainer Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              **Fine-grained Authorization with LakeFormation Integration**
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/vasveena/amazon-emr-ttt-workshop/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    vasveena/amazon-emr-ttt-workshop
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Amazon EMR Train-The-Trainer Workshop" class="md-nav__button md-logo" aria-label="Amazon EMR Train-The-Trainer Workshop" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Amazon EMR Train-The-Trainer Workshop
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vasveena/amazon-emr-ttt-workshop/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    vasveena/amazon-emr-ttt-workshop
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Part 1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Part 1" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Part 1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Introduction to Amazon EMR and Spark on EMR
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Introduction to Amazon EMR and Spark on EMR" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Introduction to Amazon EMR and Spark on EMR
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day1/fleet/exercise/" class="md-nav__link">
        1 - Launching EMR cluster with Instance Fleets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day1/spark/exercise/" class="md-nav__link">
        2 - Apache Spark on Amazon EMR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day1/step/exercise/" class="md-nav__link">
        3 - Orchestrate EMR Steps using AWS Step Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Part 2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Part 2" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Part 2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Notebook Offerings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Notebook Offerings" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Notebook Offerings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day1/studio/exercise/" class="md-nav__link">
        1 - Amazon EMR Studio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day1/mwaa/exercise/" class="md-nav__link">
        2 - Orchestration Notebook Pipelines using Amazon MWAA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day2/smstudio/exercise/" class="md-nav__link">
        3 - Sagemaker Studio Integration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Part 3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Part 3" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Part 3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_1">
          Build Incremental Data Lakes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Build Incremental Data Lakes" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Build Incremental Data Lakes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day2/hudi/exercise/" class="md-nav__link">
        1 - Apache Hudi on Amazon EMR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day2/icebrg/exercise/" class="md-nav__link">
        2 - Apache Iceberg on Amazon EMR
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Part 4
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Part 4" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Part 4
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_1" type="checkbox" id="__nav_6_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6_1">
          Deployment Options
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment Options" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Deployment Options
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../emroneks/exercise/" class="md-nav__link">
        1 - Amazon EMR on EKS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../serverless/exercise/" class="md-nav__link">
        2 - Amazon EMR Serverless
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup-okta-idp" class="md-nav__link">
    Setup Okta IdP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#set-up-lake-formation" class="md-nav__link">
    Set up Lake Formation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#launch-cloudformation-stack" class="md-nav__link">
    Launch Cloudformation Stack
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#validate-the-solution" class="md-nav__link">
    Validate the solution
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/vasveena/amazon-emr-ttt-workshop/edit/master/docs/day3/lf/exercise.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="fine-grained-authorization-with-lakeformation-integration"><strong>Fine-grained Authorization with LakeFormation Integration</strong><a class="headerlink" href="#fine-grained-authorization-with-lakeformation-integration" title="Permanent link">&para;</a></h1>
<p>In this exercise you will integrate LakeFormation with EMR for fine-grained access control.</p>
<h3 id="setup-okta-idp">Setup Okta IdP<a class="headerlink" href="#setup-okta-idp" title="Permanent link">&para;</a></h3>
<p>For this lab, you will create an Okta account with your business email. It is free to create. This is the <a href="https://developer.okta.com/signup/">sign up page</a>.</p>
<p>Once you create the account and login, this is how the page will look like.</p>
<p><img alt="lf - 1" src="../images/lf-1.png" /></p>
<p>From the left hand side pane, go to Directory -&gt; People -&gt; Add person.</p>
<p>Add the following users:</p>
<p>Analyst One – analyst1@dsar.com
Analyst Two – analyst2@dsar.com</p>
<p>For Password, choose Set by admin and enter a valid password. Deselect the option User must change password on first login. Choose Save.</p>
<p><img alt="lf - 2" src="../images/lf-2.png" /></p>
<p>Once user is created, click on the user name and go to Profile tab. Edit the profile attributes for the newly created users to specify the Display name as analyst1 and analyst2 respectively. <strong>Do not specify @dsar.com in the Display name field</strong>.</p>
<p><img alt="lf - 3" src="../images/lf-3.png" /></p>
<p>Again from the left hand side pane, go to Applications -&gt; Applications.</p>
<p>Choose Create App Integration and choose SAML 2.0. Click Next.</p>
<p><img alt="lf - 4" src="../images/lf-4.png" /></p>
<p>In App name, provide a friendly name for your application. For eg: lfemrapp. Go to next.</p>
<p>Enter following values in the next section. Replace youraccountID with your AWS event engine account ID in the two IAM ARNs in the Value column of 3rd row. Be careful to not add any extra trailing whitespaces.</p>
<table>
<thead>
<tr>
<th>#</th>
<th>Section</th>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>General</td>
<td>Single Sign-On URL</td>
<td>https://public-dns:8442/gateway/knoxsso/api/v1/websso?pac4jCallback=true&amp;client_name=SAML2Client</td>
</tr>
<tr>
<td>2</td>
<td>General</td>
<td>Audience URI (SP Entity ID)</td>
<td>urn:amazon:webservices</td>
</tr>
<tr>
<td>3</td>
<td>Attribute Statements</td>
<td>https://aws.amazon.com/SAML/Attributes/Role</td>
<td>arn:aws:iam::youraccountID:role/LF-SAML-Role-emr-lf-saml,arn:aws:iam::youraccountID:saml-provider/oktaSAMLProvider</td>
</tr>
<tr>
<td>4</td>
<td>Attribute Statements</td>
<td>https://aws.amazon.com/SAML/Attributes/RoleSessionName</td>
<td>user.displayName</td>
</tr>
<tr>
<td>5</td>
<td>Attribute Statements</td>
<td>https://glue.amazon.com/SAML/Attributes/UserName</td>
<td>user.displayName</td>
</tr>
</tbody>
</table>
<p>Filled out form with above values looks like below.</p>
<p><img alt="lf - 5" src="../images/lf-5.png" /></p>
<p>Go to Next. Choose "I'm an Okta customer adding an internal app".</p>
<p><img alt="lf - 6" src="../images/lf-6.png" /></p>
<p>Click Finish. Your application will now be created and will be in active state.</p>
<p><img alt="lf - 7" src="../images/lf-7.png" /></p>
<p>Now go the Assignments tab (last tab in the above screenshot) to assign analyst1 and analyst2 to this newly created application. <strong>Do not specify @dsar.com in the User Name field when assigning people to the application.</strong>.</p>
<p>Click on Assign -&gt; Assign to People.</p>
<p><img alt="lf - 8" src="../images/lf-8.png" /></p>
<p>Click on Assign next to analyst 1 and analyst 2 users. Remove the @dsar.com for both users. <strong>Do not specify @dsar.com in the User Name field when assigning people to the application.</strong>.</p>
<p><img alt="lf - 9" src="../images/lf-9.png" /></p>
<p>Save and go back. Once both users are in Assigned state, click Done.</p>
<p>Now go to Sign On tab. Under Sign On Methods, choose the link location for the IdP metadata file (right-click) and choose Copy Link Address.</p>
<p><img alt="lf - 10" src="../images/lf-10.png" /></p>
<p>It should look like: https://dev-<oktaaccountid>.okta.com/app/<randomString>/sso/saml/metadata</p>
<p>Also, save this metadata to your local desktop. (Right click -&gt; Save File). Type .xml as extension.</p>
<p><img alt="lf - 17" src="../images/lf-17.png" /></p>
<!--
### Create Identity Provider

Go to IAM Web Console -> Identity Providers -> Add Provider

Choose SAML. Provider name is oktaSAMLProvider. In the Metadata document, upload the file you downloaded in the previous step (metadata.xml).

![lf - 18](images/lf-18.png)

Click on Add Provider. -->

<h3 id="set-up-lake-formation">Set up Lake Formation<a class="headerlink" href="#set-up-lake-formation" title="Permanent link">&para;</a></h3>
<p>In your AWS Web Console (event engine), go to the <a href="https://s3.console.aws.amazon.com/s3/bucket/create?region=us-east-1">S3 Console</a> and create a bucket with the name "s3://mrworkshop-youraccountID-lf" in us-east-1 region. You can leave all other S3 settings defaulted.</p>
<p><img alt="lf - 22" src="../images/lf-22.png" /></p>
<p>OR if you are logged in to the <a href="https://us-east-1.console.aws.amazon.com/ec2/v2/home?region=us-east-1#Instances:v=3;search=:jumphost">EC2 instance</a> "JumpHost" via Session Manager, you can run the following commands to create a new bucket in us-east-1 region.</p>
<div class="codehilite"><pre><span></span><code><span class="n">accountID</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">aws</span><span class="w"> </span><span class="n">sts</span><span class="w"> </span><span class="n">get</span><span class="o">-</span><span class="n">caller</span><span class="o">-</span><span class="n">identity</span><span class="w"> </span><span class="o">--</span><span class="n">query</span><span class="w"> </span><span class="s">&quot;Account&quot;</span><span class="w"> </span><span class="o">--</span><span class="k">output</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"></span>
<span class="n">aws</span><span class="w"> </span><span class="n">s3</span><span class="w"> </span><span class="n">mb</span><span class="w"> </span><span class="nl">s3:</span><span class="c1">//mrworkshop-$accountID-lf --region us-east-1</span>
</code></pre></div>

<p>In your AWS Web Console (event engine), go to the AWS Lake Formation Console. Once you go to the console, the screen will look like below.</p>
<p><img alt="lf - 11" src="../images/lf-11.png" /></p>
<p>Click Get Started.</p>
<p>In left side pane, under Data catalog, choose Settings. For Data catalog settings, deselect the two permissions check-boxes. Choose Save.</p>
<p><img alt="lf - 12" src="../images/lf-12.png" /></p>
<p>In left side pane, go to Permissions -&gt; Administrative roles and tasks. In Database creators section, click on Revoke. Under IAM users and roles, type IAMAllowedPrincipals and select it from drop down. Select "Create Database" and click "Revoke".</p>
<p><img alt="lf - 13" src="../images/lf-13.png" /></p>
<p>Now, choose Data catalog -&gt; Databases from the left navigation pane. Choose Create database.</p>
<p>Database name: lfoktasamlblogdb</p>
<p>For Location, enter S3 path with your account ID replaced -&gt; s3://mrworkshop-youraccountID-dayone/lf/</p>
<p><img alt="lf - 14" src="../images/lf-14.png" /></p>
<p>Click Create Database.</p>
<h3 id="launch-cloudformation-stack">Launch Cloudformation Stack<a class="headerlink" href="#launch-cloudformation-stack" title="Permanent link">&para;</a></h3>
<p>Now, launch the <a href="https://console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks/create/template?stackName=emr-lf-saml&amp;templateURL=https://vasveena-test-demo.s3.amazonaws.com/template/emr-lf-saml.json">CloudFormation Stack</a> (Right click -&gt; Open Link in New Tab).</p>
<p>Provide following parameters. Replace youraccountID with your AWS event engine account ID.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>StackName</td>
<td>emr-lf-saml</td>
</tr>
<tr>
<td>userBucketName</td>
<td>s3://mrworkshop-youraccountID-dayone/</td>
</tr>
<tr>
<td>OktaAppMetadataURL</td>
<td>metadata URL we copied from the Okta console</td>
</tr>
<tr>
<td>SAMLProviderName</td>
<td>oktaSAMLProvider</td>
</tr>
<tr>
<td>Realm</td>
<td>EC2.INTERNAL</td>
</tr>
<tr>
<td>KdcAdminPassword</td>
<td>Test123$</td>
</tr>
<tr>
<td>ReleaseLabel</td>
<td>emr-5.31.0</td>
</tr>
<tr>
<td>InstanceType</td>
<td>c4.xlarge</td>
</tr>
<tr>
<td>VPCSubnet</td>
<td>Choose MMPublicSubnetOne</td>
</tr>
<tr>
<td>myIPCidr</td>
<td>0.0.0.0/0</td>
</tr>
<tr>
<td>oktaUser1</td>
<td>analyst1</td>
</tr>
<tr>
<td>oktaUser2</td>
<td>analyst2</td>
</tr>
<tr>
<td>EC2KeyPair</td>
<td>ee-default-keypair</td>
</tr>
</tbody>
</table>
<p>Screenshot of filled values:</p>
<p><img alt="lf - 15" src="../images/lf-15.png" /></p>
<p>Click on Next two times. Then check "I acknowledge that AWS CloudFormation might create IAM resources with custom names." and click "Create Stack".  </p>
<p><img alt="lf - 16" src="../images/lf-16.png" /></p>
<p>The stack will take about 15 minutes to get created.</p>
<p>Once the stack is created, in the Outputs tab of the Cloud Formation console, make a note of the primary DNS, SAML role ARN, and IdP ARN.</p>
<p>Go back to your Okta page. Go to General tab under application. Update the attributes.</p>
<h3 id="validate-the-solution">Validate the solution<a class="headerlink" href="#validate-the-solution" title="Permanent link">&para;</a></h3>
<p>Launch a web browser in incognito mode and open a Zeppelin notebook using the URL https://<EMR primary DNS>:8442/gateway/default/zeppelin/ (replace <EMR primary DNS> with the master node public DNS of the EMR cluster obtained from Cloudformation Output).</p>
<p>The Single Sign-On login page appears. Okta validates the login credentials with the system of record, like Active Directory, and returns a SAML, which is parsed and the next page is displayed based on the redirect URL parameter.</p>
<p>Log in to Zeppelin as analyst1.</p>
<p><img alt="lf - 18" src="../images/lf-18.jpeg" /></p>
<p>After login, choose Create a note and run this SQL statement:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">spark</span>.<span class="nv">sql</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">select * from lfoktasamlblogdb.taxi_data limit 10</span><span class="s2">&quot;</span><span class="ss">)</span>.<span class="k">show</span><span class="ss">()</span>
</code></pre></div>

<p>The following screenshot shows that analyst1 can only see the two columns that you specified in Lake Formation.</p>
<p><img alt="lf - 19" src="../images/lf-19.jpeg" /></p>
<p>Open another web browser in incognito mode and log in to Zeppelin as analyst2.</p>
<p><img alt="lf - 20" src="../images/lf-20.jpeg" /></p>
<p>The same select query shows all the columns, as shown in the following screenshot.</p>
<p><img alt="lf - 21" src="../images/lf-21.jpeg" /></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.092fa1f6.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.5a9542cf.min.js"></script>
      
    
  </body>
</html>