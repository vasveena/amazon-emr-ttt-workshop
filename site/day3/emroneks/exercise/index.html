
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.11">
    
    
      
        <title>1 - Amazon EMR on EKS - Amazon EMR Train-The-Trainer Workshop</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50e68009.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#amazon-emr-on-eks" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Amazon EMR Train-The-Trainer Workshop" class="md-header__button md-logo" aria-label="Amazon EMR Train-The-Trainer Workshop" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Amazon EMR Train-The-Trainer Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              1 - Amazon EMR on EKS
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/vasveena/amazon-emr-ttt-workshop/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    vasveena/amazon-emr-ttt-workshop
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Amazon EMR Train-The-Trainer Workshop" class="md-nav__button md-logo" aria-label="Amazon EMR Train-The-Trainer Workshop" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Amazon EMR Train-The-Trainer Workshop
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vasveena/amazon-emr-ttt-workshop/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    vasveena/amazon-emr-ttt-workshop
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Part 1
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Part 1" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Part 1
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_1">
          Introduction to Amazon EMR and Spark on EMR
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Introduction to Amazon EMR and Spark on EMR" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          Introduction to Amazon EMR and Spark on EMR
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day1/fleet/exercise/" class="md-nav__link">
        1 - Launching EMR cluster with Instance Fleets
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day1/spark/exercise/" class="md-nav__link">
        2 - Apache Spark on Amazon EMR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day1/step/exercise/" class="md-nav__link">
        3 - Orchestrate EMR Steps using AWS Step Functions
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Part 2
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Part 2" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Part 2
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_1" type="checkbox" id="__nav_4_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_1">
          Notebook Offerings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Notebook Offerings" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Notebook Offerings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day1/studio/exercise/" class="md-nav__link">
        1 - Amazon EMR Studio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day1/mwaa/exercise/" class="md-nav__link">
        2 - Orchestration Notebook Pipelines using Amazon MWAA
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day2/smstudio/exercise/" class="md-nav__link">
        3 - Sagemaker Studio Integration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Part 3
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Part 3" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Part 3
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5_1">
          Build Incremental Data Lakes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Build Incremental Data Lakes" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Build Incremental Data Lakes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day2/hudi/exercise/" class="md-nav__link">
        1 - Apache Hudi on Amazon EMR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day2/icebrg/exercise/" class="md-nav__link">
        2 - Apache Iceberg on Amazon EMR
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Part 4
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Part 4" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Part 4
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6_1" type="checkbox" id="__nav_6_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_6_1">
          Deployment Options
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment Options" data-md-level="2">
        <label class="md-nav__title" for="__nav_6_1">
          <span class="md-nav__icon md-icon"></span>
          Deployment Options
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          1 - Amazon EMR on EKS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        1 - Amazon EMR on EKS
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-the-emr-on-eks-virtual-clusters" class="md-nav__link">
    Create the EMR on EKS virtual clusters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-cloud9-workspace" class="md-nav__link">
    Build the Cloud9 workspace
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-tools" class="md-nav__link">
    Install Tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submit-jobs-using-emr-on-eks" class="md-nav__link">
    Submit jobs using EMR on EKS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submit-jobs-to-ec2-namespace" class="md-nav__link">
    Submit jobs to EC2 namespace
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pass-advanced-configs-as-json-to-the-api" class="md-nav__link">
    Pass Advanced Configs as JSON to the API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#change-emr-release-label" class="md-nav__link">
    Change EMR Release Label
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submit-serverless-spark-jobs-using-fargate" class="md-nav__link">
    Submit serverless Spark jobs using Fargate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-kubernetes-dashboard" class="md-nav__link">
    Deploy Kubernetes Dashboard
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#orchestrate-jobs-on-emr-on-eks-using-amazon-mwaa" class="md-nav__link">
    Orchestrate jobs on EMR on EKS using Amazon MWAA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-az-placement" class="md-nav__link">
    Single AZ placement
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../serverless/exercise/" class="md-nav__link">
        2 - Amazon EMR Serverless
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Part 5
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Part 5" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Part 5
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../lf/exercise/" class="md-nav__link">
        LakeFormation Integration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Part 6
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Part 6" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Part 6
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hive/exercise/" class="md-nav__link">
        Hive and Presto on Amazon EMR
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-the-emr-on-eks-virtual-clusters" class="md-nav__link">
    Create the EMR on EKS virtual clusters
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-the-cloud9-workspace" class="md-nav__link">
    Build the Cloud9 workspace
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-tools" class="md-nav__link">
    Install Tools
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submit-jobs-using-emr-on-eks" class="md-nav__link">
    Submit jobs using EMR on EKS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submit-jobs-to-ec2-namespace" class="md-nav__link">
    Submit jobs to EC2 namespace
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pass-advanced-configs-as-json-to-the-api" class="md-nav__link">
    Pass Advanced Configs as JSON to the API
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#change-emr-release-label" class="md-nav__link">
    Change EMR Release Label
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submit-serverless-spark-jobs-using-fargate" class="md-nav__link">
    Submit serverless Spark jobs using Fargate
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#deploy-kubernetes-dashboard" class="md-nav__link">
    Deploy Kubernetes Dashboard
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#orchestrate-jobs-on-emr-on-eks-using-amazon-mwaa" class="md-nav__link">
    Orchestrate jobs on EMR on EKS using Amazon MWAA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#single-az-placement" class="md-nav__link">
    Single AZ placement
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/vasveena/amazon-emr-ttt-workshop/edit/master/docs/day3/emroneks/exercise.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="amazon-emr-on-eks"><strong>Amazon EMR on EKS</strong><a class="headerlink" href="#amazon-emr-on-eks" title="Permanent link">&para;</a></h1>
<p>In this exercise, you will run Spark applications using EMR on EKS. For this exercise, we are going to use an EKS cluster created using the CloudFormation template. If you are interested in building this environment end-to-end, you can do that following the first 10 steps (until line 131) in this <a href="https://github.com/vasveena/EMROnEKS/blob/main/emroneks-note">note</a>.</p>
<h3 id="create-the-emr-on-eks-virtual-clusters">Create the EMR on EKS virtual clusters<a class="headerlink" href="#create-the-emr-on-eks-virtual-clusters" title="Permanent link">&para;</a></h3>
<p>Go to the <a href="https://us-east-1.console.aws.amazon.com/cloudformation/home?region=us-east-1#/stacks?filteringStatus=active&amp;filteringText=&amp;viewNested=true&amp;hideStacks=false">CloudFormation Web Console</a> (Right click -&gt; Open Link in New Tab) and see if you have the CloudFormation stack named "emr-on-eks" deployed in your AWS event engine accounts.</p>
<p><img alt="ee - 1" src="../images/ee-1.png" /></p>
<p>Now go to the EC2 and search for "jumphost". Choose the instance starting with the name "emr-on-eks-PrepStack". Connect to this instance using Session Manager.</p>
<p><img alt="ee - 2" src="../images/ee-2.png" /></p>
<p>Once you are inside the session manager, do NOT switch to the ec2-user. Export the AWS credentials of your AWS event engine accounts (follow the step 6 of <a href="/setup">Setup</a>).</p>
<div class="codehilite"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">AWS_DEFAULT_REGION</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">AWS_ACCESS_KEY_ID</span><span class="o">=&lt;</span><span class="n">redacted</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">AWS_SECRET_ACCESS_KEY</span><span class="o">=&lt;</span><span class="n">redacted</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">AWS_SESSION_TOKEN</span><span class="o">=&lt;</span><span class="n">redacted</span><span class="o">&gt;</span><span class="w"></span>
</code></pre></div>

<p>Next, run the following command to configure the Kubernetes client (kubectl) and download the certificate from the Amazon EKS control plane for authentication.</p>
<div class="codehilite"><pre><span></span><code>sudo sed -i &#39;s|&lt;REGION&gt;|us-east-1|g&#39; /tmp/aws-logging-cloudwatch-configmap.yaml
sudo sed -i &#39;s|auto_create_group On|auto_create_group true|g&#39; /tmp/aws-logging-cloudwatch-configmap.yaml

sh /tmp/kubeconfig.sh
</code></pre></div>

<p><img alt="ee - 3" src="../images/ee-3.png" /></p>
<p>It will take about 2 mins to complete. Once done, you will see the 3 nodes of the deployed EKS cluster in ready status.</p>
<p><img alt="ee - 4" src="../images/ee-4.png" /></p>
<p>Go to the <a href="https://us-east-1.console.aws.amazon.com/eks/home?region=us-east-1#/clusters">EKS Web console</a> (Right click -&gt; Open Link in New Tab) and check the cluster myEKS.</p>
<p><img alt="ee - 15" src="../images/ee-15.png" /></p>
<p>Click on the cluster and look at the 3 EC2 nodes in the Overview section. These are the EC2 instances of the EKS cluster.</p>
<p><img alt="ee - 16" src="../images/ee-16.png" /></p>
<p>Go to Configuration -&gt; Compute and scroll down to see the Fargate profile attached to the EKS cluster.</p>
<p><img alt="ee - 17" src="../images/ee-17.png" /></p>
<p>Run the following command to register the EKS namespace backed by EC2 instances with an EMR virtual cluster.</p>
<div class="codehilite"><pre><span></span><code>sh /tmp/emroneks.sh ec2-ns ec2-vc
</code></pre></div>

<p>Run the following command to register the EKS namespace backed by Fargate profile with another EMR virtual cluster.</p>
<div class="codehilite"><pre><span></span><code>sh /tmp/emroneks-fargate.sh fargate-vc
</code></pre></div>

<p>You can now go to the <a href="https://us-east-1.console.aws.amazon.com/elasticmapreduce/home?region=us-east-1#">EMR Web Console</a> (Right click -&gt; Open Link in New Tab). On the bottom left side pane, you will be able to see the "EMR on EKS" section. Click on Virtual clusters. You can see the two EMR on EKS virtual clusters created for EC2 and Fargate namespaces respectively. Virtual clusters do not run any resources.</p>
<p><img alt="ee - 5" src="../images/ee-5.png" /></p>
<h3 id="build-the-cloud9-workspace">Build the Cloud9 workspace<a class="headerlink" href="#build-the-cloud9-workspace" title="Permanent link">&para;</a></h3>
<p>We will use Cloud9 to observe Kubernetes dashboards. Go to the <a href="https://us-east-1.console.aws.amazon.com/cloud9/home/product">Cloud9 Web Console</a> (Right click -&gt; Open Link in New Tab) -&gt; Create environment.</p>
<p><img alt="ee - 6" src="../images/ee-6.png" /></p>
<p>In Step 1, name your environment like "emr-on-eks-platform".</p>
<p>In Step 2, choose t3.small for instance type. Leave the values for Environment type, Instance type, Platform defaulted. Choose Network settings (advanced) and choose VPC. Select the VPC starting with the name "emr-on-eks-EksStack".</p>
<p><img alt="ee - 7" src="../images/ee-7.png" /></p>
<p>Go to Next Step and create environment. This will take a few minutes.</p>
<p>Once the environment is created, click on the grey circle button in top right corner and select Manage EC2 Instance.</p>
<p><img alt="ee - 8" src="../images/ee-8.png" /></p>
<p>You will be taken to the cloud9 instance in the EC2 console. Select the instance, then choose Actions / Security / Modify IAM Role.</p>
<p><img alt="ee - 9" src="../images/ee-9.png" /></p>
<p>Select the IAM role that looks like "emr-on-eks-PrepStack-XXXX-rJumpHostInstanceProfile" and Save.</p>
<p><img alt="ee - 10" src="../images/ee-10.png" /></p>
<p>Now return to your Cloud9 workspace and click the gear icon in top right corner.</p>
<p>Select AWS SETTINGS. Turn off AWS managed temporary credentials. Close the Preferences tab.</p>
<p><img alt="ee - 11" src="../images/ee-11.png" /></p>
<h3 id="install-tools">Install Tools<a class="headerlink" href="#install-tools" title="Permanent link">&para;</a></h3>
<p>Let's install eksctl and kubectl in our Cloud9 environment. Kubernetes uses a command line utility called kubectl for communicating with the cluster API server. eksctl is a simple CLI tool for creating and managing EKS clusters.</p>
<p>Run the following commands in your Cloud9 IDE. You can expand the bash screen for better visibility.</p>
<p>Upgrade your AWS CLI.</p>
<div class="codehilite"><pre><span></span><code>pip3 install awscli --upgrade --user
</code></pre></div>

<p>Install eksctl with following commands.</p>
<div class="codehilite"><pre><span></span><code><span class="n">curl</span><span class="w"> </span><span class="o">--</span><span class="n">silent</span><span class="w"> </span><span class="o">--</span><span class="n">location</span><span class="w"> </span><span class="s2">&quot;https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz&quot;</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">tar</span><span class="w"> </span><span class="n">xz</span><span class="w"> </span><span class="o">-</span><span class="n">C</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="w"></span>

<span class="n">sudo</span><span class="w"> </span><span class="n">mv</span><span class="w"> </span><span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">eksctl</span><span class="w"> </span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">bin</span><span class="w"></span>

<span class="n">eksctl</span><span class="w"> </span><span class="n">version</span><span class="w"></span>
</code></pre></div>

<p>Install kubectl with following commands and associate it with the EKS cluster.</p>
<div class="codehilite"><pre><span></span><code><span class="n">curl</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">kubectl</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">amazon</span><span class="o">-</span><span class="n">eks</span><span class="o">.</span><span class="n">s3</span><span class="o">.</span><span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mf">2.</span><span class="n">amazonaws</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="mf">1.19</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="mi">2021</span><span class="o">-</span><span class="mi">01</span><span class="o">-</span><span class="mi">05</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">amd64</span><span class="o">/</span><span class="n">kubectl</span><span class="w"></span>

<span class="n">chmod</span><span class="w"> </span><span class="o">+</span><span class="n">x</span><span class="w"> </span><span class="o">./</span><span class="n">kubectl</span><span class="w"></span>

<span class="n">mkdir</span><span class="w"> </span><span class="o">-</span><span class="n">p</span><span class="w"> </span><span class="o">$</span><span class="n">HOME</span><span class="o">/</span><span class="n">bin</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">cp</span><span class="w"> </span><span class="o">./</span><span class="n">kubectl</span><span class="w"> </span><span class="o">$</span><span class="n">HOME</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">kubectl</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="k">export</span><span class="w"> </span><span class="n">PATH</span><span class="o">=$</span><span class="n">PATH</span><span class="p">:</span><span class="o">$</span><span class="n">HOME</span><span class="o">/</span><span class="n">bin</span><span class="w"></span>

<span class="n">echo</span><span class="w"> </span><span class="s1">&#39;export PATH=$PATH:$HOME/bin&#39;</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="o">~/.</span><span class="n">bashrc</span><span class="w"></span>

<span class="n">kubectl</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="o">--</span><span class="n">short</span><span class="w"> </span><span class="o">--</span><span class="n">client</span><span class="w"></span>

<span class="n">aws</span><span class="w"> </span><span class="n">eks</span><span class="w"> </span><span class="n">update</span><span class="o">-</span><span class="n">kubeconfig</span><span class="w"> </span><span class="o">--</span><span class="n">region</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="w"> </span><span class="o">--</span><span class="n">name</span><span class="w"> </span><span class="n">myEKS</span><span class="w"></span>

<span class="n">kubectl</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="o">-</span><span class="n">o</span><span class="w"> </span><span class="n">wide</span><span class="w"></span>
</code></pre></div>

<p>The last command should display the EC2 nodes of your EKS cluster.</p>
<p><img alt="ee - 13" src="../images/ee-13.png" /></p>
<p>Similarly, running the eksctl get cluster command should display the myEKS cluster.</p>
<div class="codehilite"><pre><span></span><code><span class="n">eksctl</span><span class="w"> </span><span class="n">get</span><span class="w"> </span><span class="n">cluster</span><span class="w"> </span><span class="o">--</span><span class="n">region</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mh">1</span><span class="w"></span>
</code></pre></div>

<p><img alt="ee - 14" src="../images/ee-14.png" /></p>
<p>Run the following command and see if the EMR on EKS clusters we created are getting listed.</p>
<div class="codehilite"><pre><span></span><code><span class="n">aws</span><span class="w"> </span><span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="w"> </span><span class="n">list</span><span class="o">-</span><span class="n">virtual</span><span class="o">-</span><span class="n">clusters</span><span class="w"> </span><span class="o">--</span><span class="n">region</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mh">1</span><span class="w"></span>
</code></pre></div>

<p><img alt="ee - 12" src="../images/ee-12.png" /></p>
<h3 id="submit-jobs-using-emr-on-eks">Submit jobs using EMR on EKS<a class="headerlink" href="#submit-jobs-using-emr-on-eks" title="Permanent link">&para;</a></h3>
<p>Now, lets submit jobs to these clusters. For that, we are going to use <a href="https://docs.aws.amazon.com/cli/latest/reference/emr-containers/index.html">EMR Containers</a> API.</p>
<p>To make it easy, lets assign variables to be used in these APIs.</p>
<div class="codehilite"><pre><span></span><code><span class="n">sudo</span><span class="w"> </span><span class="n">yum</span><span class="w"> </span><span class="n">install</span><span class="w"> </span><span class="o">-</span><span class="n">y</span><span class="w"> </span><span class="n">jq</span><span class="w"></span>

<span class="n">ec2_vc</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">aws</span><span class="w"> </span><span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="w"> </span><span class="n">list</span><span class="o">-</span><span class="n">virtual</span><span class="o">-</span><span class="n">clusters</span><span class="w"> </span><span class="o">--</span><span class="n">region</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mh">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">jq</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="p">.&#39;</span><span class="n">virtualClusters</span><span class="p">[]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select</span><span class="p">(.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;ec2-vc&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">.</span><span class="n">id</span><span class="p">&#39;)</span><span class="w"></span>

<span class="n">fargate_vc</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">aws</span><span class="w"> </span><span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="w"> </span><span class="n">list</span><span class="o">-</span><span class="n">virtual</span><span class="o">-</span><span class="n">clusters</span><span class="w"> </span><span class="o">--</span><span class="n">region</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mh">1</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">jq</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="p">.&#39;</span><span class="n">virtualClusters</span><span class="p">[]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select</span><span class="p">(.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;fargate-vc&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">.</span><span class="n">id</span><span class="p">&#39;)</span><span class="w"></span>

<span class="n">emrOnEksExecRoleArn</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">aws</span><span class="w"> </span><span class="n">iam</span><span class="w"> </span><span class="n">list</span><span class="o">-</span><span class="n">roles</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">jq</span><span class="w"> </span><span class="o">-</span><span class="n">r</span><span class="w"> </span><span class="p">.&#39;</span><span class="n">Roles</span><span class="p">[]</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">select</span><span class="p">(.</span><span class="n">RoleName</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">endswith</span><span class="p">(</span><span class="s">&quot;-EMRExectionRole&quot;</span><span class="p">))</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="p">.</span><span class="n">Arn</span><span class="p">&#39;)</span><span class="w"></span>

<span class="n">accountID</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="n">aws</span><span class="w"> </span><span class="n">sts</span><span class="w"> </span><span class="n">get</span><span class="o">-</span><span class="n">caller</span><span class="o">-</span><span class="n">identity</span><span class="w"> </span><span class="o">--</span><span class="n">query</span><span class="w"> </span><span class="n">Account</span><span class="w"> </span><span class="o">--</span><span class="k">output</span><span class="w"> </span><span class="n">text</span><span class="p">)</span><span class="w"></span>
</code></pre></div>

<h3 id="submit-jobs-to-ec2-namespace">Submit jobs to EC2 namespace<a class="headerlink" href="#submit-jobs-to-ec2-namespace" title="Permanent link">&para;</a></h3>
<p>Let us submit a Spark job to the EMR on EKS cluster with namespace attached to the EC2 node group. No need to change anything since we have used variables.</p>
<div class="codehilite"><pre><span></span><code>aws emr-containers start-job-run --virtual-cluster-id <span class="cp">${</span><span class="n">ec2_vc</span><span class="cp">}</span> \
--name spark-pi-6.5 \
--execution-role-arn <span class="cp">${</span><span class="n">emrOnEksExecRoleArn</span><span class="cp">}</span> \
--release-label emr-6.5.0-latest \
--job-driver &#39;{
    &quot;sparkSubmitJobDriver&quot;: {
        &quot;entryPoint&quot;: &quot;s3://aws-data-analytics-workshops/emr-eks-workshop/scripts/pi.py&quot;,
        &quot;sparkSubmitParameters&quot;: &quot;--conf spark.executor.instances=2 --conf spark.executor.memory=2G --conf spark.executor.cores=2 --conf spark.driver.cores=1&quot;
        }
    }&#39; \
--configuration-overrides &#39;{&quot;monitoringConfiguration&quot;: {&quot;cloudWatchMonitoringConfiguration&quot;: {&quot;logGroupName&quot;: &quot;emroneks&quot;}}}&#39; \
--region us-east-1
</code></pre></div>

<p>You should get the below response.</p>
<p>{
    "virtualClusterId": "vaqteerxju21c161kkr7awe00",
    "arn": "arn:aws:emr-containers:us-east-1:156321623241:/virtualclusters/vaqteerxju21c161kkr7awe00/jobruns/00000002vtm1d42gmtd",
    "id": "00000002vtm1d42gmtd",
    "name": "spark-pi-6.5"
}</p>
<p>Right after this, execute the below command to see what happens on the EC2 namespace in your EKS cluster.</p>
<div class="codehilite"><pre><span></span><code>kubectl get pods -n ec2-ns --watch
</code></pre></div>

<p>Almost immediately you will see EMR virtual cluster will create driver and executor pods on the EC2 namespace of your EKS cluster.</p>
<p><img alt="ee - 18" src="../images/ee-18.png" /></p>
<p>Check the job in the <a href="https://us-east-1.console.aws.amazon.com/elasticmapreduce/home?region=us-east-1#virtual-cluster-list:">EMR Web Console</a> (Right click -&gt; Open Link in New Tab) -&gt; ec2-vc. You will see that the job is completed.</p>
<p><img alt="ee - 19" src="../images/ee-19.png" /></p>
<p>Click on "View Logs" to open the persistent Spark history server.</p>
<p><img alt="ee - 20" src="../images/ee-20.png" /></p>
<p>You can also check the Spark job logs by going to <a href="https://us-east-1.console.aws.amazon.com/cloudwatch/home?region=us-east-1#home:">CloudWatch Web Console</a> (Right click -&gt; Open Link in New Tab) and clicking on "Log groups". You will see there is a log group called "emroneks".</p>
<p><img alt="ee - 21" src="../images/ee-21.png" /></p>
<p>You can see the driver and executor logs.</p>
<p><img alt="ee - 22" src="../images/ee-22.png" /></p>
<h3 id="pass-advanced-configs-as-json-to-the-api">Pass Advanced Configs as JSON to the API<a class="headerlink" href="#pass-advanced-configs-as-json-to-the-api" title="Permanent link">&para;</a></h3>
<p>Let's run a Spark ETL job with Glue metastore integration and configure it to send driver and executor logs to S3 and Cloudwatch log group.</p>
<p>This is the ETL job (spark-etl-glue.py) we are going to use which will read data, do some basic transformations and write the output to a table on AWS Glue data catalog. This code is just for your reference.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SparkSession</span>
<span class="kn">from</span> <span class="nn">pyspark.sql</span> <span class="kn">import</span> <span class="n">SQLContext</span>
<span class="kn">from</span> <span class="nn">pyspark.sql.functions</span> <span class="kn">import</span> <span class="o">*</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">))</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Usage: spark-etl-glue [input-folder] [output-folder] [dbName]&quot;</span><span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">spark</span> <span class="o">=</span> <span class="n">SparkSession</span>\
        <span class="o">.</span><span class="n">builder</span>\
        <span class="o">.</span><span class="n">appName</span><span class="p">(</span><span class="s2">&quot;Python Spark SQL Glue integration example&quot;</span><span class="p">)</span>\
        <span class="o">.</span><span class="n">enableHiveSupport</span><span class="p">()</span>\
        <span class="o">.</span><span class="n">getOrCreate</span><span class="p">()</span>

    <span class="n">nyTaxi</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;inferSchema&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;header&quot;</span><span class="p">,</span> <span class="s2">&quot;true&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">updatedNYTaxi</span> <span class="o">=</span> <span class="n">nyTaxi</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;current_date&quot;</span><span class="p">,</span> <span class="n">lit</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()))</span>

    <span class="n">updatedNYTaxi</span><span class="o">.</span><span class="n">printSchema</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">updatedNYTaxi</span><span class="o">.</span><span class="n">show</span><span class="p">())</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total number of records: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">updatedNYTaxi</span><span class="o">.</span><span class="n">count</span><span class="p">()))</span>

    <span class="n">updatedNYTaxi</span><span class="o">.</span><span class="n">write</span><span class="o">.</span><span class="n">parquet</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">updatedNYTaxi</span><span class="o">.</span><span class="n">registerTempTable</span><span class="p">(</span><span class="s2">&quot;ny_taxi_table&quot;</span><span class="p">)</span>

    <span class="n">dbName</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;CREATE database if not exists &quot;</span> <span class="o">+</span> <span class="n">dbName</span><span class="p">)</span>
    <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;USE &quot;</span> <span class="o">+</span> <span class="n">dbName</span><span class="p">)</span>
    <span class="n">spark</span><span class="o">.</span><span class="n">sql</span><span class="p">(</span><span class="s2">&quot;CREATE table if not exists ny_taxi_parquet USING PARQUET LOCATION &#39;&quot;</span> <span class="o">+</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;&#39; AS SELECT * from ny_taxi_table &quot;</span><span class="p">)</span>
</code></pre></div>

<p>We will create a JSON with all the configurations we need using the below command.</p>
<div class="codehilite"><pre><span></span><code>sudo tee ./emroneks-config.json &gt;/dev/null <span class="err">&lt;</span><span class="nt">&lt;EOF</span>
<span class="err">{</span>
<span class="err">&quot;name&quot;:</span> <span class="err">&quot;spark-glue-integration-and-s3-log&quot;,</span>
<span class="err">&quot;virtualClusterId&quot;:</span> <span class="err">&quot;${ec2_vc}&quot;,</span>
<span class="err">&quot;executionRoleArn&quot;:</span> <span class="err">&quot;${emrOnEksExecRoleArn}&quot;,</span>
<span class="err">&quot;releaseLabel&quot;:</span> <span class="err">&quot;emr-6.5.0-latest&quot;,</span>
<span class="err">&quot;jobDriver&quot;:</span> <span class="err">{</span>
<span class="err">&quot;sparkSubmitJobDriver&quot;:</span> <span class="err">{</span>
<span class="err">&quot;entryPoint&quot;:</span> <span class="err">&quot;s3://aws-data-analytics-workshops/emr-eks-workshop/scripts/spark-etl-glue.py&quot;,</span>
<span class="err">&quot;entryPointArguments&quot;:</span> <span class="err">[</span>
<span class="err">&quot;s3://aws-data-analytics-workshops/shared_datasets/tripdata/&quot;,&quot;s3://mrworkshop-$accountID-dayone/taxi-data-glue/&quot;,&quot;tripdata&quot;</span>
<span class="err">],</span>
<span class="err">&quot;sparkSubmitParameters&quot;:</span> <span class="err">&quot;--conf</span> <span class="err">spark.driver.</span><span class="na">cores=</span><span class="s">1</span> <span class="err">--conf</span> <span class="err">spark.executor.</span><span class="na">memory=</span><span class="s">2G</span> <span class="err">--conf</span> <span class="err">spark.driver.</span><span class="na">memory=</span><span class="s">2G</span> <span class="err">--conf</span> <span class="err">spark.executor.</span><span class="na">cores=</span><span class="s">2&quot;</span>
<span class="err">}</span>
<span class="err">},</span>
<span class="err">&quot;configurationOverrides&quot;:</span> <span class="err">{</span>
<span class="err">&quot;applicationConfiguration&quot;:</span> <span class="err">[{</span>
<span class="err">&quot;classification&quot;:</span> <span class="err">&quot;spark-defaults&quot;,</span>
<span class="err">&quot;properties&quot;:</span> <span class="err">{</span>
<span class="err">&quot;spark.dynamicAllocation.enabled&quot;:</span> <span class="err">&quot;false&quot;,</span>
<span class="err">&quot;spark.hadoop.hive.metastore.client.factory.class&quot;:&quot;com.amazonaws.glue.catalog.metastore.AWSGlueDataCatalogHiveClientFactory&quot;</span>
<span class="err">}</span>
<span class="err">},</span>
<span class="err">{</span>
<span class="err">&quot;classification&quot;:</span> <span class="err">&quot;spark-log4j&quot;,</span>
<span class="err">&quot;properties&quot;:</span> <span class="err">{</span>
<span class="err">&quot;log4j.rootCategory&quot;:</span> <span class="err">&quot;DEBUG,</span> <span class="err">console&quot;</span>
<span class="err">}</span>
<span class="err">}</span>
<span class="err">],</span>
<span class="err">&quot;monitoringConfiguration&quot;:</span> <span class="err">{</span>
<span class="err">&quot;cloudWatchMonitoringConfiguration&quot;:</span> <span class="err">{</span>
<span class="err">&quot;logGroupName&quot;:</span> <span class="err">&quot;emroneks&quot;</span>
<span class="err">},</span>
<span class="err">&quot;s3MonitoringConfiguration&quot;:</span> <span class="err">{</span>
<span class="err">&quot;logUri&quot;:</span> <span class="err">&quot;s3://mrworkshop-$accountID-dayone/emroneks/logs/&quot;</span>
<span class="err">}</span>
<span class="err">}</span>
<span class="err">}</span>
<span class="err">}</span>
<span class="err">EOF</span>
</code></pre></div>

<p>Now you can pass the config file we created in your API.</p>
<div class="codehilite"><pre><span></span><code><span class="n">aws</span><span class="w"> </span><span class="n">emr</span><span class="o">-</span><span class="n">containers</span><span class="w"> </span><span class="n">start</span><span class="o">-</span><span class="n">job</span><span class="o">-</span><span class="n">run</span><span class="w"> </span><span class="o">--</span><span class="n">cli</span><span class="o">-</span><span class="k">input</span><span class="o">-</span><span class="n">json</span><span class="w"> </span><span class="nl">file:</span><span class="c1">//emroneks-config.json --region us-east-1</span>
</code></pre></div>

<p>You can find the Spark driver and executor pod logs in S3 for the above job.</p>
<p><img alt="ee - 23" src="../images/ee-23.png" /></p>
<p>You can also see the table "ny_taxi_parquet" in database "tripdata" created in AWS Glue data log. Go to <a href="https://us-east-1.console.aws.amazon.com/athena/home?region=us-east-1#/query-editor">Athena Web Console</a> and see the table under database "tripdata". Since this is the first time we are using Athena, in order to run queries, you need to go to the Settings -&gt; Manage add an S3 location in your account to save your query results. For example: s3://mrworkshop-<accountID>-dayone/athena/.</p>
<p><img alt="ee - 24" src="../images/ee-24.png" /></p>
<p>You can query the table now.</p>
<div class="codehilite"><pre><span></span><code>select * from tripdata.ny_taxi_parquet limit 10;
</code></pre></div>

<p><img alt="ee - 25" src="../images/ee-25.png" /></p>
<h3 id="change-emr-release-label">Change EMR Release Label<a class="headerlink" href="#change-emr-release-label" title="Permanent link">&para;</a></h3>
<p>One of the important features with EMR on EKS is the ability to change major and minor versions per release label. So far we submitted jobs using EMR 6.5.0 label. Let's now submit the jobs to other release labels.  </p>
<p>Let's submit a job to EMR 5.34.0 label.</p>
<div class="codehilite"><pre><span></span><code>aws emr-containers start-job-run --virtual-cluster-id <span class="cp">${</span><span class="n">ec2_vc</span><span class="cp">}</span> \
--name spark-pi-5.34 \
--execution-role-arn <span class="cp">${</span><span class="n">emrOnEksExecRoleArn</span><span class="cp">}</span> \
--release-label emr-5.34.0-latest \
--job-driver &#39;{
    &quot;sparkSubmitJobDriver&quot;: {
        &quot;entryPoint&quot;: &quot;s3://aws-data-analytics-workshops/emr-eks-workshop/scripts/pi.py&quot;,
        &quot;sparkSubmitParameters&quot;: &quot;--conf spark.executor.instances=2 --conf spark.executor.memory=2G --conf spark.executor.cores=2 --conf spark.driver.cores=1&quot;
        }
    }&#39; \
--configuration-overrides &#39;{&quot;monitoringConfiguration&quot;: {&quot;cloudWatchMonitoringConfiguration&quot;: {&quot;logGroupName&quot;: &quot;emroneks&quot;}}}&#39; \
--region us-east-1
</code></pre></div>

<p>Similarly, you can change the minor versions also. Let's submit the same job to EMR 6.2.0.</p>
<div class="codehilite"><pre><span></span><code>aws emr-containers start-job-run --virtual-cluster-id <span class="cp">${</span><span class="n">ec2_vc</span><span class="cp">}</span> \
--name spark-pi-6.2 \
--execution-role-arn <span class="cp">${</span><span class="n">emrOnEksExecRoleArn</span><span class="cp">}</span> \
--release-label emr-6.2.0-latest \
--job-driver &#39;{
    &quot;sparkSubmitJobDriver&quot;: {
        &quot;entryPoint&quot;: &quot;s3://aws-data-analytics-workshops/emr-eks-workshop/scripts/pi.py&quot;,
        &quot;sparkSubmitParameters&quot;: &quot;--conf spark.executor.instances=2 --conf spark.executor.memory=2G --conf spark.executor.cores=2 --conf spark.driver.cores=1&quot;
        }
    }&#39; \
--configuration-overrides &#39;{&quot;monitoringConfiguration&quot;: {&quot;cloudWatchMonitoringConfiguration&quot;: {&quot;logGroupName&quot;: &quot;emroneks&quot;}}}&#39; \
--region us-east-1
</code></pre></div>

<p>Notice the jobs in <a href="https://us-east-1.console.aws.amazon.com/elasticmapreduce/home?region=us-east-1#virtual-cluster-list:">EMR on EKS console</a> (Right click -&gt; Open Link in New Tab). We are consolidating jobs from different versions in the same infrastructure on EKS.</p>
<h3 id="submit-serverless-spark-jobs-using-fargate">Submit serverless Spark jobs using Fargate<a class="headerlink" href="#submit-serverless-spark-jobs-using-fargate" title="Permanent link">&para;</a></h3>
<p>So far we were using EC2 namespace to submit jobs. We have an EMR on EKS virtual cluster created for Fargate namespace as well. Let's submit serverless Spark jobs using Fargate.</p>
<p>Run the below command. Notice that for --virtual-cluster-id we are passing the EMR on EKS cluster mapped to Fargate namespace.</p>
<div class="codehilite"><pre><span></span><code>aws emr-containers start-job-run --virtual-cluster-id <span class="cp">${</span><span class="n">fargate_vc</span><span class="cp">}</span> \
--name spark-pi-5.34 \
--execution-role-arn <span class="cp">${</span><span class="n">emrOnEksExecRoleArn</span><span class="cp">}</span> \
--release-label emr-5.34.0-latest \
--job-driver &#39;{
    &quot;sparkSubmitJobDriver&quot;: {
        &quot;entryPoint&quot;: &quot;s3://aws-data-analytics-workshops/emr-eks-workshop/scripts/pi.py&quot;,
        &quot;sparkSubmitParameters&quot;: &quot;--conf spark.executor.instances=2 --conf spark.executor.memory=2G --conf spark.executor.cores=2 --conf spark.driver.cores=1&quot;
        }
    }&#39; \
--configuration-overrides &#39;{&quot;monitoringConfiguration&quot;: {&quot;cloudWatchMonitoringConfiguration&quot;: {&quot;logGroupName&quot;: &quot;emroneks&quot;}}}&#39; \
--region us-east-1
</code></pre></div>

<p>You will see the job being submitted to Fargate virtual cluster.</p>
<p><img alt="ee - 31" src="../images/ee-31.png" /></p>
<p>Now go to the <a href="https://us-east-1.console.aws.amazon.com/eks/home?region=us-east-1#/clusters">EKS Web console</a> (Right click -&gt; Open Link in New Tab) -&gt; Overview. In about a minute, you will see that the fargate resource has come up to run this job. Fargate automatically scales up and down based on your processing requirements.</p>
<p><img alt="ee - 32" src="../images/ee-32.png" /></p>
<h3 id="deploy-kubernetes-dashboard">Deploy Kubernetes Dashboard<a class="headerlink" href="#deploy-kubernetes-dashboard" title="Permanent link">&para;</a></h3>
<p>Kubernetes Dashboard is a web-based user interface. You can use Dashboard to get an overview of applications running on your cluster. In this lab we will deploy the official Kubernetes Dashboard. Check the documentation <a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">here</a>.</p>
<p>To deploy the dashboard, run the following command:</p>
<div class="codehilite"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">DASHBOARD_VERSION</span><span class="o">=</span><span class="s2">&quot;v2.0.0&quot;</span><span class="w"></span>
<span class="n">kubectl</span><span class="w"> </span><span class="n">apply</span><span class="w"> </span><span class="o">-</span><span class="n">f</span><span class="w"> </span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">dashboard</span><span class="o">/$</span><span class="p">{</span><span class="n">DASHBOARD_VERSION</span><span class="p">}</span><span class="o">/</span><span class="n">aio</span><span class="o">/</span><span class="n">deploy</span><span class="o">/</span><span class="n">recommended</span><span class="o">.</span><span class="n">yaml</span><span class="w"></span>
</code></pre></div>

<p>You can access Dashboard using the kubectl command-line tool by running the following command in your Cloud9 terminal. This will start the proxy on port 8080.</p>
<div class="codehilite"><pre><span></span><code>kubectl proxy --port=8080 --address=0.0.0.0 --disable-filter=true &amp;
</code></pre></div>

<p>In your Cloud9 workspace, click Tools / Preview / Preview Running Application. Scroll to the end of the browser address URL and append the following:</p>
<div class="codehilite"><pre><span></span><code>/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/
</code></pre></div>

<p><img alt="ee - 26" src="../images/ee-26.png" /></p>
<p>You will see the Kubernetes dashboard asking for token.</p>
<p><img alt="ee - 27" src="../images/ee-27.png" /></p>
<p>Once you have the login screen in the Cloud9 preview browser tab, press the Pop Out button <img alt="ee - 28" src="../images/ee-28.png" /> to open the login screen in a regular browser tab, like below:</p>
<p><img alt="ee - 29" src="../images/ee-29.png" /></p>
<p>To get the token, you need to create an EKS admin account. Let's do that by running following commands on Cloud9.</p>
<div class="codehilite"><pre><span></span><code>sudo tee ./eks-admin-service-account.yaml &gt;/dev/null &lt;&lt;EOF
apiVersion: v1
kind: ServiceAccount
metadata:
  name: eks-admin
  namespace: kube-system
---
apiVersion: rbac.authorization.k8s.io/v1beta1
kind: ClusterRoleBinding
metadata:
  name: eks-admin
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: cluster-admin
subjects:
- kind: ServiceAccount
  name: eks-admin
  namespace: kube-system
EOF

kubectl apply -f eks-admin-service-account.yaml
</code></pre></div>

<p>Now, run the below command in Cloud9 and paste the "token" of the output on to your browser where it prompts you to enter token.</p>
<div class="codehilite"><pre><span></span><code>kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep eks-admin | awk &#39;{print $1}&#39;)
</code></pre></div>

<p>You will now be able to see the dashboard.</p>
<p><img alt="ee - 30" src="../images/ee-30.png" /></p>
<p>Submit a job again.</p>
<div class="codehilite"><pre><span></span><code>aws emr-containers start-job-run --virtual-cluster-id <span class="cp">${</span><span class="n">fargate_vc</span><span class="cp">}</span> \
--name spark-pi-5.34 \
--execution-role-arn <span class="cp">${</span><span class="n">emrOnEksExecRoleArn</span><span class="cp">}</span> \
--release-label emr-5.34.0-latest \
--job-driver &#39;{
    &quot;sparkSubmitJobDriver&quot;: {
        &quot;entryPoint&quot;: &quot;s3://aws-data-analytics-workshops/emr-eks-workshop/scripts/pi.py&quot;,
        &quot;sparkSubmitParameters&quot;: &quot;--conf spark.executor.instances=2 --conf spark.executor.memory=2G --conf spark.executor.cores=2 --conf spark.driver.cores=1&quot;
        }
    }&#39; \
--configuration-overrides &#39;{&quot;monitoringConfiguration&quot;: {&quot;cloudWatchMonitoringConfiguration&quot;: {&quot;logGroupName&quot;: &quot;emroneks&quot;}}}&#39; \
--region us-east-1
</code></pre></div>

<p>Explore the dashboard.</p>
<h3 id="orchestrate-jobs-on-emr-on-eks-using-amazon-mwaa">Orchestrate jobs on EMR on EKS using Amazon MWAA<a class="headerlink" href="#orchestrate-jobs-on-emr-on-eks-using-amazon-mwaa" title="Permanent link">&para;</a></h3>
<p>Let's submit (or orchestrate) jobs to EMR on EKS through Amazon MWAA. Go to the <a href="https://us-east-1.console.aws.amazon.com/mwaa/home?region=us-east-1#environments">MWAA Web Console</a> (Right click -&gt; Open Link in New Tab). You will find a new environment starting with name "emr-on-eks-MWAAStack". Open the airflow UI.</p>
<p>You will see two DAGs. One for EC2 namespace and one for fargate namespace.</p>
<p><img alt="ee - 33" src="../images/ee-33.png" /></p>
<p>Toggle the DAGs ON and trigger the DAGs manually. This job copies, unzips and transforms files from S3 and then runs some analytics on top of this transformed data.</p>
<p><img alt="ee - 34" src="../images/ee-34.png" /></p>
<p>This DAG takes about 10-12 mins end-to-end. You can check the status in <a href="https://us-east-1.console.aws.amazon.com/elasticmapreduce/home?region=us-east-1#virtual-cluster-list:">EMR on EKS console</a> (Right click -&gt; Open Link in New Tab).</p>
<p><img alt="ee - 36" src="../images/ee-36.png" /></p>
<h3 id="single-az-placement">Single AZ placement<a class="headerlink" href="#single-az-placement" title="Permanent link">&para;</a></h3>
<p>Our EMR on EKS cluster uses two AZs: us-east-1a and us-east-1b. Go to the Nodes section in Kubernetes dashboard to see which EC2 nodes belong to which AZ. This provides resiliency when compared to EMR on EC2 which runs on a single AZ. However, cross-AZ communication may impact performance and cost. You can define topology for your jobs and instruct all pods to launch in a single AZ. Let's see an example.</p>
<div class="codehilite"><pre><span></span><code>aws emr-containers start-job-run --virtual-cluster-id <span class="cp">${</span><span class="n">ec2_vc</span><span class="cp">}</span> \
--name spark-single-az-us-east-1a \
--execution-role-arn <span class="cp">${</span><span class="n">emrOnEksExecRoleArn</span><span class="cp">}</span> \
--release-label emr-5.34.0-latest \
--job-driver &#39;{
    &quot;sparkSubmitJobDriver&quot;: {
        &quot;entryPoint&quot;: &quot;s3://aws-data-analytics-workshops/emr-eks-workshop/scripts/pi.py&quot;,
        &quot;sparkSubmitParameters&quot;: &quot;--conf spark.kubernetes.node.selector.topology.kubernetes.io/zone=&#39;us-east-1a&#39; --conf spark.executor.instances=1 --conf spark.executor.memory=2G --conf spark.executor.cores=2 --conf spark.driver.cores=1&quot;
        }
    }&#39; \
--configuration-overrides &#39;{&quot;monitoringConfiguration&quot;: {&quot;cloudWatchMonitoringConfiguration&quot;: {&quot;logGroupName&quot;: &quot;emroneks&quot;}}}&#39; \
--region us-east-1
</code></pre></div>

<p>Check the Pods section of Kubernetes dashboard. You will see that the pods are launched only on nodes running in us-east-1a.</p>
<p><img alt="ee - 35" src="../images/ee-35.png" /></p>
<p>You can test the same command by substituting us-east-1a with us-east-1b and see how the pods are getting placed in your Kubernetes dashboard.</p>
<div class="codehilite"><pre><span></span><code>aws emr-containers start-job-run --virtual-cluster-id <span class="cp">${</span><span class="n">ec2_vc</span><span class="cp">}</span> \
--name spark-single-az-us-east-1b \
--execution-role-arn <span class="cp">${</span><span class="n">emrOnEksExecRoleArn</span><span class="cp">}</span> \
--release-label emr-5.34.0-latest \
--job-driver &#39;{
    &quot;sparkSubmitJobDriver&quot;: {
        &quot;entryPoint&quot;: &quot;s3://aws-data-analytics-workshops/emr-eks-workshop/scripts/pi.py&quot;,
        &quot;sparkSubmitParameters&quot;: &quot;--conf spark.kubernetes.node.selector.topology.kubernetes.io/zone=&#39;us-east-1b&#39; --conf spark.executor.instances=1 --conf spark.executor.memory=2G --conf spark.executor.cores=2 --conf spark.driver.cores=1&quot;
        }
    }&#39; \
--configuration-overrides &#39;{&quot;monitoringConfiguration&quot;: {&quot;cloudWatchMonitoringConfiguration&quot;: {&quot;logGroupName&quot;: &quot;emroneks&quot;}}}&#39; \
--region us-east-1
</code></pre></div>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../" class="md-footer__link md-footer__link--prev" aria-label="Previous: Introduction" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Introduction
            </div>
          </div>
        </a>
      
      
        
        <a href="../../serverless/exercise/" class="md-footer__link md-footer__link--next" aria-label="Next: 2 - Amazon EMR Serverless" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              2 - Amazon EMR Serverless
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.092fa1f6.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.5a9542cf.min.js"></script>
      
    
  </body>
</html>