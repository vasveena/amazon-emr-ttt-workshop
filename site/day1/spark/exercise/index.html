
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.1.11">
    
    
      
        <title>2 - Apache Spark on Amazon EMR - Amazon EMR Train-The-Trainer Workshop</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50e68009.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#exercise-2-apache-spark-on-amazon-emr" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Amazon EMR Train-The-Trainer Workshop" class="md-header__button md-logo" aria-label="Amazon EMR Train-The-Trainer Workshop" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Amazon EMR Train-The-Trainer Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2 - Apache Spark on Amazon EMR
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/vasveena/amazon-emr-ttt-workshop/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    vasveena/amazon-emr-ttt-workshop
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Amazon EMR Train-The-Trainer Workshop" class="md-nav__button md-logo" aria-label="Amazon EMR Train-The-Trainer Workshop" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Amazon EMR Train-The-Trainer Workshop
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/vasveena/amazon-emr-ttt-workshop/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    vasveena/amazon-emr-ttt-workshop
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../setup/" class="md-nav__link">
        Setup
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Day 1 Exercises
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day 1 Exercises" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Day 1 Exercises
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fleet/exercise/" class="md-nav__link">
        1 - Launching EMR cluster with Instance Fleets
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          2 - Apache Spark on Amazon EMR
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        2 - Apache Spark on Amazon EMR
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-setup" class="md-nav__link">
    Initial Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-spark-submit-and-spark-shell" class="md-nav__link">
    Using spark-submit and spark-shell
  </a>
  
    <nav class="md-nav" aria-label="Using spark-submit and spark-shell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#investigate-spark-ui" class="md-nav__link">
    Investigate Spark UI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-approach-local-ssh-tunneling" class="md-nav__link">
    Alternative approach - Local SSH tunneling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimization-exercise-optional" class="md-nav__link">
    Optimization exercise (Optional)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submit-spark-work-to-emr-using-addsteps-api" class="md-nav__link">
    Submit Spark Work to EMR using AddSteps API
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../studio/exercise/" class="md-nav__link">
        3 - Amazon EMR Studio
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hudi/exercise/" class="md-nav__link">
        4 - Apache Hudi on Amazon EMR
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../icebrg/exercise/" class="md-nav__link">
        5 - Apache Iceberg on Amazon EMR
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Day 2 Exercises
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Day 2 Exercises" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Day 2 Exercises
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day2/mwaa/exercise/" class="md-nav__link">
        1 - Orchestration using Amazon MWAA
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          2 - Deployment Options
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="2 - Deployment Options" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          2 - Deployment Options
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day2/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day2/emroneks/exercise/" class="md-nav__link">
        2.1 - Amazon EMR on EKS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../day2/serverless/exercise/" class="md-nav__link">
        2.2 - Amazon EMR Serverless
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-setup" class="md-nav__link">
    Initial Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-spark-submit-and-spark-shell" class="md-nav__link">
    Using spark-submit and spark-shell
  </a>
  
    <nav class="md-nav" aria-label="Using spark-submit and spark-shell">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#investigate-spark-ui" class="md-nav__link">
    Investigate Spark UI
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#alternative-approach-local-ssh-tunneling" class="md-nav__link">
    Alternative approach - Local SSH tunneling
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optimization-exercise-optional" class="md-nav__link">
    Optimization exercise (Optional)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#submit-spark-work-to-emr-using-addsteps-api" class="md-nav__link">
    Submit Spark Work to EMR using AddSteps API
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/vasveena/amazon-emr-ttt-workshop/edit/master/docs/day1/spark/exercise.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="exercise-2-apache-spark-on-amazon-emr"><strong> Exercise 2 - Apache Spark on Amazon EMR </strong><a class="headerlink" href="#exercise-2-apache-spark-on-amazon-emr" title="Permanent link">&para;</a></h1>
<h3 id="initial-setup">Initial Setup<a class="headerlink" href="#initial-setup" title="Permanent link">&para;</a></h3>
<p>SSH to the leader node of the EMR cluster "EMR-Spark-Hive-Presto". The key pair you downloaded in the Setup can be used to SSH via terminal or using an SSH client like Putty. To make it easy, ssm-agent has been installed on all EMR nodes via a bootstrap action so that you can use AWS Systems Manager to login to your client EC2 instance and EMR leader node.</p>
<p>Go to AWS Management Console on your browser -&gt; Amazon EMR Console -&gt; Hardware Tab. You will see MASTER and CORE fleets. Click on the MASTER instance fleet id (looks like if-XXXXXXXXXX).</p>
<p><img alt="Spark - 1" src="../images/spark-1.png" /></p>
<p>Click on the EC2 instance ID (looks like i-xxxxxxxxxxx). It should take you to the EC2 management console.</p>
<p><img alt="Spark - 2" src="../images/spark-2.png" /></p>
<p>You will be navigated to the EC2 management console.</p>
<p><img alt="Spark - 3" src="../images/spark-3.png" /></p>
<p>Click on “Connect” and go to the tab “Session Manager”. Click on Connect.</p>
<p><img alt="Spark - 4" src="../images/spark-4.png" /></p>
<p>You will be navigated to the AWS Session Manager session. In the session, type the following commands to log in as hadoop user (default OS user for EMR).</p>
<div class="codehilite"><pre><span></span><code>sudo su hadoop
cd ~
</code></pre></div>

<p><img alt="Spark - 5" src="../images/spark-5.png" /></p>
<p>You will use the same login method to log in to other EC2 instances in this workshop as well.</p>
<h3 id="using-spark-submit-and-spark-shell">Using spark-submit and spark-shell<a class="headerlink" href="#using-spark-submit-and-spark-shell" title="Permanent link">&para;</a></h3>
<p>Once you are logged into the EMR cluster using SSH or SSM agent, type “spark-shell” on your EMR Leader Node.</p>
<p><img alt="Spark - 6" src="../images/spark-6.png" /></p>
<p>Once spark-shell opens and the Spark session object is created, run the commands below -  </p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">org.apache.spark.sql.types.</span><span class="p">{</span><span class="n">IntegerType</span><span class="p">,</span><span class="n">StringType</span><span class="p">,</span><span class="n">StructType</span><span class="p">,</span><span class="n">StructField</span><span class="p">,</span><span class="n">DoubleType</span><span class="p">}</span>

<span class="n">val</span> <span class="n">schema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">(</span><span class="n">Array</span><span class="p">(</span><span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;s_suppkey&quot;</span><span class="p">,</span><span class="n">IntegerType</span><span class="p">,</span><span class="n">true</span><span class="p">),</span> <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;s_name&quot;</span><span class="p">,</span><span class="n">StringType</span><span class="p">,</span><span class="n">true</span><span class="p">),</span> <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;s_address&quot;</span><span class="p">,</span><span class="n">StringType</span><span class="p">,</span><span class="n">true</span><span class="p">),</span> <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;s_nationkey&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span> <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;s_phone&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span> <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;s_acctbal&quot;</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span> <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;s_comment&quot;</span><span class="p">,</span><span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">)))</span>

<span class="n">val</span> <span class="n">df</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;delimiter&quot;</span><span class="p">,</span> <span class="s2">&quot;|&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&quot;s3://redshift-downloads/TPC-H/3TB/supplier/&quot;</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="n">val</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="err">$</span><span class="s2">&quot;s_acctbal&quot;</span> <span class="o">&gt;</span> <span class="n">lit</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span><span class="o">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s2">&quot;randdom&quot;</span><span class="p">,</span><span class="n">lit</span><span class="p">(</span><span class="s2">&quot;insert random column&quot;</span><span class="p">))</span>

<span class="n">df2</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</code></pre></div>

<p>You will see the results in the spark-shell session.</p>
<p><img alt="Spark - 7" src="../images/spark-7.png" /></p>
<h4 id="investigate-spark-ui">Investigate Spark UI<a class="headerlink" href="#investigate-spark-ui" title="Permanent link">&para;</a></h4>
<p>While the Spark session is still active, you can check the Spark UI. You will need to install <a href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html">AWS CLI</a> and <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html">Session Manager plugin</a> on your local desktop to do this.</p>
<p>You will also need to update your PATH variable if it is not done automatically following <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-troubleshooting.html#windows-plugin-env-var-not-set">this</a> document. Otherwise you may get the error "SessionManagerPlugin is not found". Replace --target with your leader node instance ID in the following command. Replace the environmental variables with the values from the Team Dashboard. For Windows, you will need to use "set"  instead of "export".</p>
<div class="codehilite"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">AWS_DEFAULT_REGION</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">AWS_ACCESS_KEY_ID</span><span class="o">=&lt;</span><span class="n">redacted</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">AWS_SECRET_ACCESS_KEY</span><span class="o">=&lt;</span><span class="n">redacted</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">AWS_SESSION_TOKEN</span><span class="o">=&lt;</span><span class="n">redacted</span><span class="o">&gt;</span><span class="w"></span>
</code></pre></div>

<p>Run the below command. Replace target with your leader node instance ID</p>
<div class="codehilite"><pre><span></span><code><span class="n">aws</span><span class="w"> </span><span class="n">ssm</span><span class="w"> </span><span class="n">start</span><span class="o">-</span><span class="n">session</span><span class="w"> </span><span class="o">--</span><span class="n">target</span><span class="w"> </span><span class="n">i</span><span class="o">-</span><span class="mf">00785e8946</span><span class="n">b4ff636</span><span class="w"> </span><span class="o">--</span><span class="n">document</span><span class="o">-</span><span class="n">name</span><span class="w"> </span><span class="n">AWS</span><span class="o">-</span><span class="n">StartPortForwardingSession</span><span class="w"> </span><span class="o">--</span><span class="n">parameters</span><span class="w"> </span><span class="p">&#39;{</span><span class="s">&quot;portNumber&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;18080&quot;</span><span class="p">],</span><span class="w"> </span><span class="s">&quot;localPortNumber&quot;</span><span class="o">:</span><span class="p">[</span><span class="s">&quot;8158&quot;</span><span class="p">]}&#39;</span><span class="w"> </span><span class="o">--</span><span class="n">region</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mh">1</span><span class="w"></span>
</code></pre></div>

<p>Following image shows the commands run in macOS terminal. <em>18080</em> is the Spark History Server Port and <em>8157</em> is the local port.</p>
<p><img alt="Spark - 8" src="../images/spark-8.png" /></p>
<p>Now open http://localhost:8158 in your browser.  </p>
<p><img alt="Spark - 10" src="../images/spark-10.png" /></p>
<p>Click on "Show incomplete applications" -&gt; App ID (for eg: application_1647720368860_0002). Check out all the tabs especially the SQL tab.</p>
<p><img alt="Spark - 11" src="../images/spark-11.png" /></p>
<p>Click on "show" (Spark action) in the SQL tab to see the query plan.</p>
<p><img alt="Spark - 12" src="../images/spark-12.png" /></p>
<h4 id="alternative-approach-local-ssh-tunneling">Alternative approach - Local SSH tunneling<a class="headerlink" href="#alternative-approach-local-ssh-tunneling" title="Permanent link">&para;</a></h4>
<p>Please note that with this approach, you cannot access YARN Resource Manager UI. You can access it via <a href="https://docs.aws.amazon.com/emr/latest/ManagementGuide/emr-ssh-tunnel-local.html">local port forwarding</a> by running the following command in your local desktop's terminal or using Putty for Windows. Replace leaderNodePublicDNS with your leader node public DNS (obtained from EMR Web Console -&gt; EMR-Spark-Hive-Presto -&gt; Summary tab -&gt; Master public DNS).</p>
<div class="codehilite"><pre><span></span><code><span class="n">ssh</span><span class="w"> </span><span class="o">-</span><span class="n">i</span><span class="w"> </span><span class="o">~/</span><span class="n">ee</span><span class="o">-</span><span class="k">default</span><span class="o">-</span><span class="n">keypair</span><span class="p">.</span><span class="n">pem</span><span class="w"> </span><span class="o">-</span><span class="n">N</span><span class="w"> </span><span class="o">-</span><span class="n">L</span><span class="w"> </span><span class="mi">8157</span><span class="err">:</span><span class="nl">leaderNodePublicDNS</span><span class="p">:</span><span class="mi">8088</span><span class="w"> </span><span class="n">hadoop</span><span class="nv">@leaderNodePublicDNS</span><span class="w"></span>
</code></pre></div>

<p>Now enter http://localhost:8157 on your browser to see the Resource Manager UI. You can use this method as well to access Spark UI (replace port 8088 in the above command with port 18080).</p>
<p><img alt="Spark - 9" src="../images/spark-9.png" /></p>
<h4 id="optimization-exercise-optional">Optimization exercise (Optional)<a class="headerlink" href="#optimization-exercise-optional" title="Permanent link">&para;</a></h4>
<p><strong>Converting inefficient join types</strong></p>
<p>Run the below code block in spark-shell. Set driver memory to 4G while starting the shell.</p>
<p>spark-shell --driver-memory=4G</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">org.apache.spark.sql.types._</span>

<span class="n">val</span> <span class="n">liSchema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">(</span><span class="n">Array</span><span class="p">(</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_orderkey&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_partkey&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_suppkey&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_linenumber&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_quantity&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_extendedprice&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_discount&quot;</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_tax&quot;</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_returnflag&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_linestatus&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_shipdate&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_commitdate&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_receiptdate&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_shipinstruct&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_shipmode&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;l_comment&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">)</span>

<span class="n">val</span> <span class="n">orSchema</span> <span class="o">=</span> <span class="n">StructType</span><span class="p">(</span><span class="n">Array</span><span class="p">(</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;o_orderkey&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;o_custkey&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;o_orderstatus&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;o_totalprice&quot;</span><span class="p">,</span> <span class="n">DoubleType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;o_orderdate&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;o_orderpriority&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;o_clerk&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;o_shippriority&quot;</span><span class="p">,</span> <span class="n">IntegerType</span><span class="p">,</span> <span class="n">true</span><span class="p">),</span>
  <span class="n">StructField</span><span class="p">(</span><span class="s2">&quot;o_comment&quot;</span><span class="p">,</span> <span class="n">StringType</span><span class="p">,</span> <span class="n">true</span><span class="p">)</span>
  <span class="p">)</span>
<span class="p">)</span>

<span class="n">val</span> <span class="n">df1</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">liSchema</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;delimiter&quot;</span><span class="p">,</span><span class="s2">&quot;|&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&quot;s3://redshift-downloads/TPC-H/2.18/3TB/lineitem/&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">df2</span> <span class="o">=</span> <span class="n">spark</span><span class="o">.</span><span class="n">read</span><span class="o">.</span><span class="n">schema</span><span class="p">(</span><span class="n">orSchema</span><span class="p">)</span><span class="o">.</span><span class="n">option</span><span class="p">(</span><span class="s2">&quot;delimiter&quot;</span><span class="p">,</span><span class="s2">&quot;|&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">csv</span><span class="p">(</span><span class="s2">&quot;s3://redshift-downloads/TPC-H/2.18/3TB/orders/&quot;</span><span class="p">)</span>
<span class="n">val</span> <span class="n">lineitem</span> <span class="o">=</span> <span class="n">df1</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">val</span> <span class="n">orders</span> <span class="o">=</span> <span class="n">df2</span><span class="o">.</span><span class="n">limit</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>

<span class="n">val</span> <span class="n">nestedLoopDF</span> <span class="o">=</span> <span class="n">lineitem</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">orders</span><span class="p">,</span> <span class="n">lineitem</span><span class="p">(</span><span class="s2">&quot;l_orderkey&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="n">orders</span><span class="p">(</span><span class="s2">&quot;o_orderkey&quot;</span><span class="p">)</span> <span class="o">||</span> <span class="n">lineitem</span><span class="p">(</span><span class="s2">&quot;l_receiptdate&quot;</span><span class="p">)</span> <span class="o">===</span> <span class="n">orders</span><span class="p">(</span><span class="s2">&quot;o_orderdate&quot;</span><span class="p">))</span>
<span class="n">nestedLoopDF</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="n">truncate</span><span class="o">=</span><span class="n">false</span><span class="p">)</span>
</code></pre></div>

<p>Check the Spark UI -&gt; SQL tab -&gt; show (Spark action). You will be able to see that the above code uses BroadcastNestedLoopJoin as the join type.</p>
<p><img alt="Spark - 18" src="../images/spark-18.png" /></p>
<p>BroadcastNestedLoopJoin is an inefficient join that results from bad coding practice. Convert it into SortMergeJoin or BroadcastJoin by changing the code.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">val</span> <span class="nv">result1</span> <span class="o">=</span> <span class="nv">lineitem</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">orders</span>, <span class="nv">lineitem</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">l_orderkey</span><span class="s2">&quot;</span><span class="ss">)</span> <span class="o">===</span> <span class="nv">orders</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">o_orderkey</span><span class="s2">&quot;</span><span class="ss">))</span>
<span class="nv">val</span> <span class="nv">result2</span> <span class="o">=</span> <span class="nv">lineitem</span>.<span class="nv">join</span><span class="ss">(</span><span class="nv">orders</span>, <span class="nv">lineitem</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">l_receiptdate</span><span class="s2">&quot;</span><span class="ss">)</span> <span class="o">===</span> <span class="nv">orders</span><span class="ss">(</span><span class="s2">&quot;</span><span class="s">o_orderdate</span><span class="s2">&quot;</span><span class="ss">))</span>
<span class="nv">val</span> <span class="nv">broadcastDF</span> <span class="o">=</span> <span class="nv">result1</span>.<span class="nv">union</span><span class="ss">(</span><span class="nv">result2</span><span class="ss">)</span>
<span class="nv">broadcastDF</span>.<span class="k">show</span><span class="ss">(</span><span class="mi">5</span>,<span class="nv">truncate</span><span class="o">=</span><span class="nv">false</span><span class="ss">)</span>
</code></pre></div>

<p>Check the Spark UI now. You will be able to see that BroadcastHashJoin is being used instead which is the best join type if at least one of the two tables you are going to join is relatively small (&lt;50MB). Default <em>spark.sql.autoBroadcastJoinThreshold</em> is 10 MB.</p>
<p><img alt="Spark - 19" src="../images/spark-19.png" /></p>
<h3 id="submit-spark-work-to-emr-using-addsteps-api">Submit Spark Work to EMR using AddSteps API<a class="headerlink" href="#submit-spark-work-to-emr-using-addsteps-api" title="Permanent link">&para;</a></h3>
<p>Let us submit Spark work to the cluster using EMR’s <a href="https://docs.aws.amazon.com/cli/latest/reference/emr/add-steps.html">AddSteps</a> API.</p>
<p>Copy the EMR Cluster ID in the Summary Tab of your EMR cluster "EMR-Spark-Hive-Presto" from EMR Web Console. It looks like ‘j-XXXXXXXXXX’.</p>
<p><img alt="Spark - 13" src="../images/spark-13.png" /></p>
<p>You can submit steps to your EMR from your local desktop after exporting the AWS credentials in your Team Dashboard page.</p>
<p>For windows, use set instead of export.</p>
<div class="codehilite"><pre><span></span><code><span class="k">export</span><span class="w"> </span><span class="n">AWS_DEFAULT_REGION</span><span class="o">=</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">AWS_ACCESS_KEY_ID</span><span class="o">=&lt;</span><span class="n">redacted</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">AWS_SECRET_ACCESS_KEY</span><span class="o">=&lt;</span><span class="n">redacted</span><span class="o">&gt;</span><span class="w"></span>
<span class="k">export</span><span class="w"> </span><span class="n">AWS_SESSION_TOKEN</span><span class="o">=&lt;</span><span class="n">redacted</span><span class="o">&gt;</span><span class="w"></span>
</code></pre></div>

<p>Run the below command. Replace cluster-id value with your cluster ID.</p>
<div class="codehilite"><pre><span></span><code><span class="n">aws</span><span class="w"> </span><span class="n">emr</span><span class="w"> </span><span class="n">add</span><span class="o">-</span><span class="n">steps</span><span class="w"> </span><span class="o">--</span><span class="n">cluster</span><span class="o">-</span><span class="n">id</span><span class="w"> </span><span class="n">j</span><span class="o">-</span><span class="n">XXXXXXXXXX</span><span class="w"> </span><span class="o">--</span><span class="n">steps</span><span class="w"> </span><span class="n">Name</span><span class="o">=</span><span class="s">&quot;Spark Pi Job&quot;</span><span class="p">,</span><span class="n">Jar</span><span class="o">=</span><span class="n">command</span><span class="o">-</span><span class="n">runner</span><span class="p">.</span><span class="n">jar</span><span class="p">,</span><span class="n">Args</span><span class="o">=</span><span class="p">[</span><span class="n">spark</span><span class="o">-</span><span class="n">submit</span><span class="p">,</span><span class="o">--</span><span class="n">master</span><span class="p">,</span><span class="n">yarn</span><span class="p">,</span><span class="o">--</span><span class="n">num</span><span class="o">-</span><span class="n">executors</span><span class="p">,</span><span class="mh">2</span><span class="p">,</span><span class="o">--</span><span class="n">class</span><span class="p">,</span><span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">examples</span><span class="p">.</span><span class="n">SparkPi</span><span class="p">,</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">spark</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">jars</span><span class="o">/</span><span class="n">spark</span><span class="o">-</span><span class="n">examples</span><span class="p">.</span><span class="n">jar</span><span class="p">,</span><span class="mh">10</span><span class="p">,</span><span class="o">-</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">--</span><span class="n">region</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mh">1</span><span class="w"></span>
</code></pre></div>

<p>If you cannot use AWS CLI for some reason, you will find an EC2 instance called "JumpHost" in the EC2 Web Console. In real life scenario, you can run this command from any machine as long as your IAM user or role has IAM access to invoke EMR AddSteps API.</p>
<p><img alt="Spark - 14" src="../images/spark-14.png" /></p>
<p>You can connect to that instance using Session Manager and submit step to EMR cluster from that session. Once connected, enter following commands to login as ec2-user (default OS user for EC2 instances).</p>
<div class="codehilite"><pre><span></span><code>sudo su ec2-user
cd ~
</code></pre></div>

<p>Now, run the AddSteps CLI command below. Replace cluster-id value with your cluster ID. You do not need to export any credentials since the IAM role attached to this JumpHost has all accesses required.</p>
<div class="codehilite"><pre><span></span><code><span class="n">aws</span><span class="w"> </span><span class="n">emr</span><span class="w"> </span><span class="n">add</span><span class="o">-</span><span class="n">steps</span><span class="w"> </span><span class="o">--</span><span class="n">cluster</span><span class="o">-</span><span class="n">id</span><span class="w"> </span><span class="n">j</span><span class="o">-</span><span class="mh">142</span><span class="n">PVKGDZTTXS</span><span class="w"> </span><span class="o">--</span><span class="n">steps</span><span class="w"> </span><span class="n">Name</span><span class="o">=</span><span class="s">&quot;Spark Pi Job&quot;</span><span class="p">,</span><span class="n">Jar</span><span class="o">=</span><span class="n">command</span><span class="o">-</span><span class="n">runner</span><span class="p">.</span><span class="n">jar</span><span class="p">,</span><span class="n">Args</span><span class="o">=</span><span class="p">[</span><span class="n">spark</span><span class="o">-</span><span class="n">submit</span><span class="p">,</span><span class="o">--</span><span class="n">master</span><span class="p">,</span><span class="n">yarn</span><span class="p">,</span><span class="o">--</span><span class="n">num</span><span class="o">-</span><span class="n">executors</span><span class="p">,</span><span class="mh">2</span><span class="p">,</span><span class="o">--</span><span class="n">class</span><span class="p">,</span><span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">spark</span><span class="p">.</span><span class="n">examples</span><span class="p">.</span><span class="n">SparkPi</span><span class="p">,</span><span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">spark</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">jars</span><span class="o">/</span><span class="n">spark</span><span class="o">-</span><span class="n">examples</span><span class="p">.</span><span class="n">jar</span><span class="p">,</span><span class="mh">10</span><span class="p">,</span><span class="o">-</span><span class="n">v</span><span class="p">]</span><span class="w"> </span><span class="o">--</span><span class="n">region</span><span class="w"> </span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mh">1</span><span class="w"></span>
</code></pre></div>

<p><img alt="Spark - 15" src="../images/spark-15.png" /></p>
<p>Now, check the EMR step that was submitted to the cluster.</p>
<p><img alt="Spark - 16" src="../images/spark-16.png" /></p>
<p>You can look into the stdout logs to see the output.</p>
<p><img alt="Spark - 17" src="../images/spark-17.png" /></p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../../fleet/exercise/" class="md-footer__link md-footer__link--prev" aria-label="Previous: 1 - Launching EMR cluster with Instance Fleets" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              1 - Launching EMR cluster with Instance Fleets
            </div>
          </div>
        </a>
      
      
        
        <a href="../../studio/exercise/" class="md-footer__link md-footer__link--next" aria-label="Next: 3 - Amazon EMR Studio" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              3 - Amazon EMR Studio
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": ["tabs"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.092fa1f6.min.js"}</script>
    
    
      <script src="../../../assets/javascripts/bundle.5a9542cf.min.js"></script>
      
    
  </body>
</html>